var COMPILED=!0,goog=goog||{};goog.global=this;goog.isDef=function(b){return void 0!==b};goog.exportPath_=function(b,a,d){b=b.split(".");d=d||goog.global;b[0]in d||!d.execScript||d.execScript("var "+b[0]);for(var c;b.length&&(c=b.shift());)!b.length&&goog.isDef(a)?d[c]=a:d=d[c]?d[c]:d[c]={}};
goog.define=function(b,a){var d=a;COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,b)?d=goog.global.CLOSURE_UNCOMPILED_DEFINES[b]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,b)&&(d=goog.global.CLOSURE_DEFINES[b]));goog.exportPath_(b,d)};goog.DEBUG=!0;goog.LOCALE="en";goog.TRUSTED_SITE=!0;goog.STRICT_MODE_COMPATIBLE=!1;goog.DISALLOW_TEST_ONLY_CODE=COMPILED&&!goog.DEBUG;
goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=!1;goog.provide=function(b){if(goog.isInModuleLoader_())throw Error("goog.provide can not be used within a goog.module.");if(!COMPILED&&goog.isProvided_(b))throw Error('Namespace "'+b+'" already declared.');goog.constructNamespace_(b)};goog.constructNamespace_=function(b,a){if(!COMPILED){delete goog.implicitNamespaces_[b];for(var d=b;(d=d.substring(0,d.lastIndexOf(".")))&&!goog.getObjectByName(d);)goog.implicitNamespaces_[d]=!0}goog.exportPath_(b,a)};
goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/;goog.module=function(b){if(!goog.isString(b)||!b||-1==b.search(goog.VALID_MODULE_RE_))throw Error("Invalid module identifier");if(!goog.isInModuleLoader_())throw Error("Module "+b+" has been loaded incorrectly.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");goog.moduleLoaderState_.moduleName=b;if(!COMPILED){if(goog.isProvided_(b))throw Error('Namespace "'+b+'" already declared.');delete goog.implicitNamespaces_[b]}};
goog.module.get=function(b){return goog.module.getInternal_(b)};goog.module.getInternal_=function(b){if(!COMPILED)return goog.isProvided_(b)?b in goog.loadedModules_?goog.loadedModules_[b]:goog.getObjectByName(b):null};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return null!=goog.moduleLoaderState_};
goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0};
goog.setTestOnly=function(b){if(goog.DISALLOW_TEST_ONLY_CODE)throw b=b||"",Error("Importing test-only code into non-debug environment"+(b?": "+b:"."));};goog.forwardDeclare=function(b){};COMPILED||(goog.isProvided_=function(b){return b in goog.loadedModules_||!goog.implicitNamespaces_[b]&&goog.isDefAndNotNull(goog.getObjectByName(b))},goog.implicitNamespaces_={"goog.module":!0});
goog.getObjectByName=function(b,a){for(var d=b.split("."),c=a||goog.global,e;e=d.shift();)if(goog.isDefAndNotNull(c[e]))c=c[e];else return null;return c};goog.globalize=function(b,a){var d=a||goog.global,c;for(c in b)d[c]=b[c]};
goog.addDependency=function(b,a,d,c){if(goog.DEPENDENCIES_ENABLED){var e;b=b.replace(/\\/g,"/");var f=goog.dependencies_;c&&"boolean"!==typeof c||(c=c?{module:"goog"}:{});for(var h=0;e=a[h];h++)f.nameToPath[e]=b,f.pathIsModule[b]="goog"==c.module;for(c=0;a=d[c];c++)b in f.requires||(f.requires[b]={}),f.requires[b][a]=!0}};goog.ENABLE_DEBUG_LOADER=!0;goog.logToConsole_=function(b){goog.global.console&&goog.global.console.error(b)};
goog.require=function(b){if(!COMPILED){goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_&&goog.maybeProcessDeferredDep_(b);if(goog.isProvided_(b))return goog.isInModuleLoader_()?goog.module.getInternal_(b):null;if(goog.ENABLE_DEBUG_LOADER){var a=goog.getPathFromDeps_(b);if(a)return goog.writeScripts_(a),null}b="goog.require could not find: "+b;goog.logToConsole_(b);throw Error(b);}};goog.basePath="";goog.nullFunction=function(){};
goog.abstractMethod=function(){throw Error("unimplemented abstract method");};goog.addSingletonGetter=function(b){b.getInstance=function(){if(b.instance_)return b.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=b);return b.instance_=new b}};goog.instantiatedSingletons_=[];goog.LOAD_MODULE_USING_EVAL=!0;goog.SEAL_MODULE_EXPORTS=goog.DEBUG;goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;
goog.DEPENDENCIES_ENABLED&&(goog.dependencies_={pathIsModule:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}},goog.inHtmlDocument_=function(){var b=goog.global.document;return null!=b&&"write"in b},goog.findBasePath_=function(){if(goog.isDef(goog.global.CLOSURE_BASE_PATH))goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var b=goog.global.document.getElementsByTagName("SCRIPT"),a=b.length-1;0<=a;--a){var d=b[a].src,c=d.lastIndexOf("?"),c=-1==c?d.length:
c;if("base.js"==d.substr(c-7,7)){goog.basePath=d.substr(0,c-7);break}}},goog.importScript_=function(b,a){(goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_)(b,a)&&(goog.dependencies_.written[b]=!0)},goog.IS_OLD_IE_=!(goog.global.atob||!goog.global.document||!goog.global.document.all),goog.importModule_=function(b){goog.importScript_("",'goog.retrieveAndExecModule_("'+b+'");')&&(goog.dependencies_.written[b]=!0)},goog.queuedModules_=[],goog.wrapModule_=function(b,a){return goog.LOAD_MODULE_USING_EVAL&&
goog.isDef(goog.global.JSON)?"goog.loadModule("+goog.global.JSON.stringify(a+"\n//# sourceURL="+b+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+a+"\n;return exports});\n//# sourceURL="+b+"\n"},goog.loadQueuedModules_=function(){var b=goog.queuedModules_.length;if(0<b){var a=goog.queuedModules_;goog.queuedModules_=[];for(var d=0;d<b;d++)goog.maybeProcessDeferredPath_(a[d])}},goog.maybeProcessDeferredDep_=function(b){goog.isDeferredModule_(b)&&goog.allDepsAreAvailable_(b)&&(b=goog.getPathFromDeps_(b),
goog.maybeProcessDeferredPath_(goog.basePath+b))},goog.isDeferredModule_=function(b){return(b=goog.getPathFromDeps_(b))&&goog.dependencies_.pathIsModule[b]?goog.basePath+b in goog.dependencies_.deferred:!1},goog.allDepsAreAvailable_=function(b){if((b=goog.getPathFromDeps_(b))&&b in goog.dependencies_.requires)for(var a in goog.dependencies_.requires[b])if(!goog.isProvided_(a)&&!goog.isDeferredModule_(a))return!1;return!0},goog.maybeProcessDeferredPath_=function(b){if(b in goog.dependencies_.deferred){var a=
goog.dependencies_.deferred[b];delete goog.dependencies_.deferred[b];goog.globalEval(a)}},goog.loadModuleFromUrl=function(b){goog.retrieveAndExecModule_(b)},goog.loadModule=function(b){var a=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:void 0,declareLegacyNamespace:!1};var d;if(goog.isFunction(b))d=b.call(goog.global,{});else if(goog.isString(b))d=goog.loadModuleFromSource_.call(goog.global,b);else throw Error("Invalid module definition");var c=goog.moduleLoaderState_.moduleName;
if(!goog.isString(c)||!c)throw Error('Invalid module name "'+c+'"');goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(c,d):goog.SEAL_MODULE_EXPORTS&&Object.seal&&Object.seal(d);goog.loadedModules_[c]=d}finally{goog.moduleLoaderState_=a}},goog.loadModuleFromSource_=function(b){eval(b);return{}},goog.writeScriptSrcNode_=function(b){goog.global.document.write('<script type="text/javascript" src="'+b+'">\x3c/script>')},goog.appendScriptSrcNode_=function(b){var a=goog.global.document,
d=a.createElement("script");d.type="text/javascript";d.src=b;d.defer=!1;d.async=!1;a.head.appendChild(d)},goog.writeScriptTag_=function(b,a){if(goog.inHtmlDocument_()){var d=goog.global.document;if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&"complete"==d.readyState){if(/\bdeps.js$/.test(b))return!1;throw Error('Cannot write "'+b+'" after document load');}var c=goog.IS_OLD_IE_;void 0===a?c?(c=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ",d.write('<script type="text/javascript" src="'+
b+'"'+c+">\x3c/script>")):goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING?goog.appendScriptSrcNode_(b):goog.writeScriptSrcNode_(b):d.write('<script type="text/javascript">'+a+"\x3c/script>");return!0}return!1},goog.lastNonModuleScriptIndex_=0,goog.onScriptLoad_=function(b,a){"complete"==b.readyState&&goog.lastNonModuleScriptIndex_==a&&goog.loadQueuedModules_();return!0},goog.writeScripts_=function(b){function a(b){if(!(b in e.written||b in e.visited)){e.visited[b]=!0;if(b in e.requires)for(var f in e.requires[b])if(!goog.isProvided_(f))if(f in
e.nameToPath)a(e.nameToPath[f]);else throw Error("Undefined nameToPath for "+f);b in c||(c[b]=!0,d.push(b))}}var d=[],c={},e=goog.dependencies_;a(b);for(b=0;b<d.length;b++){var f=d[b];goog.dependencies_.written[f]=!0}var h=goog.moduleLoaderState_;goog.moduleLoaderState_=null;for(b=0;b<d.length;b++)if(f=d[b])e.pathIsModule[f]?goog.importModule_(goog.basePath+f):goog.importScript_(goog.basePath+f);else throw goog.moduleLoaderState_=h,Error("Undefined script input");goog.moduleLoaderState_=h},goog.getPathFromDeps_=
function(b){return b in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[b]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js"));goog.normalizePath_=function(b){b=b.split("/");for(var a=0;a<b.length;)"."==b[a]?b.splice(a,1):a&&".."==b[a]&&b[a-1]&&".."!=b[a-1]?b.splice(--a,2):a++;return b.join("/")};
goog.loadFileSync_=function(b){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(b);var a=new goog.global.XMLHttpRequest;a.open("get",b,!1);a.send();return a.responseText};
goog.retrieveAndExecModule_=function(b){if(!COMPILED){var a=b;b=goog.normalizePath_(b);var d=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_,c=goog.loadFileSync_(b);if(null!=c)c=goog.wrapModule_(b,c),goog.IS_OLD_IE_?(goog.dependencies_.deferred[a]=c,goog.queuedModules_.push(a)):d(b,c);else throw Error("load of "+b+"failed");}};
goog.typeOf=function(b){var a=typeof b;if("object"==a)if(b){if(b instanceof Array)return"array";if(b instanceof Object)return a;var d=Object.prototype.toString.call(b);if("[object Window]"==d)return"object";if("[object Array]"==d||"number"==typeof b.length&&"undefined"!=typeof b.splice&&"undefined"!=typeof b.propertyIsEnumerable&&!b.propertyIsEnumerable("splice"))return"array";if("[object Function]"==d||"undefined"!=typeof b.call&&"undefined"!=typeof b.propertyIsEnumerable&&!b.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==a&&"undefined"==typeof b.call)return"object";return a};goog.isNull=function(b){return null===b};goog.isDefAndNotNull=function(b){return null!=b};goog.isArray=function(b){return"array"==goog.typeOf(b)};goog.isArrayLike=function(b){var a=goog.typeOf(b);return"array"==a||"object"==a&&"number"==typeof b.length};goog.isDateLike=function(b){return goog.isObject(b)&&"function"==typeof b.getFullYear};goog.isString=function(b){return"string"==typeof b};
goog.isBoolean=function(b){return"boolean"==typeof b};goog.isNumber=function(b){return"number"==typeof b};goog.isFunction=function(b){return"function"==goog.typeOf(b)};goog.isObject=function(b){var a=typeof b;return"object"==a&&null!=b||"function"==a};goog.getUid=function(b){return b[goog.UID_PROPERTY_]||(b[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(b){return!!b[goog.UID_PROPERTY_]};
goog.removeUid=function(b){null!==b&&"removeAttribute"in b&&b.removeAttribute(goog.UID_PROPERTY_);try{delete b[goog.UID_PROPERTY_]}catch(a){}};goog.UID_PROPERTY_="closure_uid_"+(1E9*Math.random()>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(b){var a=goog.typeOf(b);if("object"==a||"array"==a){if(b.clone)return b.clone();var a="array"==a?[]:{},d;for(d in b)a[d]=goog.cloneObject(b[d]);return a}return b};
goog.bindNative_=function(b,a,d){return b.call.apply(b.bind,arguments)};goog.bindJs_=function(b,a,d){if(!b)throw Error();if(2<arguments.length){var c=Array.prototype.slice.call(arguments,2);return function(){var d=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(d,c);return b.apply(a,d)}}return function(){return b.apply(a,arguments)}};
goog.bind=function(b,a,d){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};goog.partial=function(b,a){var d=Array.prototype.slice.call(arguments,1);return function(){var a=d.slice();a.push.apply(a,arguments);return b.apply(this,a)}};goog.mixin=function(b,a){for(var d in a)b[d]=a[d]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};
goog.globalEval=function(b){if(goog.global.execScript)goog.global.execScript(b,"JavaScript");else if(goog.global.eval){if(null==goog.evalWorksForGlobals_)if(goog.global.eval("var _evalTest_ = 1;"),"undefined"!=typeof goog.global._evalTest_){try{delete goog.global._evalTest_}catch(c){}goog.evalWorksForGlobals_=!0}else goog.evalWorksForGlobals_=!1;if(goog.evalWorksForGlobals_)goog.global.eval(b);else{var a=goog.global.document,d=a.createElement("SCRIPT");d.type="text/javascript";d.defer=!1;d.appendChild(a.createTextNode(b));
a.body.appendChild(d);a.body.removeChild(d)}}else throw Error("goog.globalEval not available");};goog.evalWorksForGlobals_=null;goog.getCssName=function(b,a){var d=function(a){return goog.cssNameMapping_[a]||a},c=function(a){a=a.split("-");for(var b=[],c=0;c<a.length;c++)b.push(d(a[c]));return b.join("-")},c=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?d:c:function(a){return a};return a?b+"-"+c(a):c(b)};
goog.setCssNameMapping=function(b,a){goog.cssNameMapping_=b;goog.cssNameMappingStyle_=a};!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(b,a){a&&(b=b.replace(/\{\$([^}]+)}/g,function(b,c){return null!=a&&c in a?a[c]:b}));return b};goog.getMsgWithFallback=function(b,a){return b};goog.exportSymbol=function(b,a,d){goog.exportPath_(b,a,d)};goog.exportProperty=function(b,a,d){b[a]=d};
goog.inherits=function(b,a){function d(){}d.prototype=a.prototype;b.superClass_=a.prototype;b.prototype=new d;b.prototype.constructor=b;b.base=function(b,d,f){for(var h=Array(arguments.length-2),g=2;g<arguments.length;g++)h[g-2]=arguments[g];return a.prototype[d].apply(b,h)}};
goog.base=function(b,a,d){var c=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!c)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(c.superClass_){for(var e=Array(arguments.length-1),f=1;f<arguments.length;f++)e[f-1]=arguments[f];return c.superClass_.constructor.apply(b,e)}e=Array(arguments.length-2);for(f=2;f<arguments.length;f++)e[f-2]=arguments[f];for(var f=!1,h=b.constructor;h;h=
h.superClass_&&h.superClass_.constructor)if(h.prototype[a]===c)f=!0;else if(f)return h.prototype[a].apply(b,e);if(b[a]===c)return b.constructor.prototype[a].apply(b,e);throw Error("goog.base called from a method of one name to a method of a different name");};goog.scope=function(b){if(goog.isInModuleLoader_())throw Error("goog.scope is not supported within a goog.module.");b.call(goog.global)};COMPILED||(goog.global.COMPILED=COMPILED);
goog.defineClass=function(b,a){var d=a.constructor,c=a.statics;d&&d!=Object.prototype.constructor||(d=function(){throw Error("cannot instantiate an interface (no constructor defined).");});d=goog.defineClass.createSealingConstructor_(d,b);b&&goog.inherits(d,b);delete a.constructor;delete a.statics;goog.defineClass.applyProperties_(d.prototype,a);null!=c&&(c instanceof Function?c(d):goog.defineClass.applyProperties_(d,c));return d};goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG;
goog.defineClass.createSealingConstructor_=function(b,a){if(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function){if(a&&a.prototype&&a.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_])return b;var d=function(){var a=b.apply(this,arguments)||this;a[goog.UID_PROPERTY_]=a[goog.UID_PROPERTY_];this.constructor===d&&Object.seal(a);return a};return d}return b};goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
goog.defineClass.applyProperties_=function(b,a){for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(b[d]=a[d]);for(var c=0;c<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;c++)d=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[c],Object.prototype.hasOwnProperty.call(a,d)&&(b[d]=a[d])};goog.tagUnsealableClass=function(b){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(b.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable";var Odyssey={Generics:{}};Odyssey.Generics.extend={};Odyssey.Generics.proxy={};Odyssey.Generics.count={};(function(b){b.proxy=window.proxy=function(a,b,c){return function(){a.apply(b,c)}};b.count=window.count=function(a,b){var c=0,e,f=a.length;for(e=0;e<f;e+=1)a[e]===b&&(c+=1);return c};b.extend=window.extend=function(a){var b,c,e;for(c=arguments.length-1;0<c;--c)for(b in e=arguments[c],e)a[b]=e[b];return a}})(Odyssey.Generics);Odyssey.Events={};
Odyssey.Events.EventDispatchInterface=function(){function b(){}b.prototype.getParentEventHandler=function(){return this.eventDispatcher.getParentEventHandler()};b.prototype.setParentEventHandler=function(a){this.eventDispatcher.setParentEventHandler(a)};b.prototype.addEventListener=function(a,b){this.eventDispatcher.addListener(a,b)};b.prototype.removeEventListener=function(a,b){this.eventDispatcher.removeListener(a,b)};b.prototype.dispatchEvent=function(a,b){this.eventDispatcher.dispatch(this,a);
a.defaultPrevented||void 0===b||b.call(this,a)};return b}();Odyssey.Model={};Odyssey.Model.ModelAttributor=function(){function b(){}b.prototype.setModel=function(a){this.model=a};b.prototype.getModel=function(){return this.model};return b}();Odyssey.Events.EventHandler=function(){function b(a){this.type=a;this.listeners=[]}b.prototype.fire=function(a,b){var c,e=this.listeners.length;for(c=0;c<e&&!b.propagationStopped;c+=1)this.listeners[c].call(a,b)};b.prototype.addListener=function(a){this.listeners.push(a)};b.prototype.removeListener=function(a){a=this.listeners.indexOf(a);var b;if(-1!==a){this.listeners[a]=void 0;for(b=this.listeners.length-1;a<b;a+=1)this.listeners[a]=this.listeners[a+1];this.listeners[a]=void 0;--this.listeners.length}};
return b}();Odyssey.Events.EventDispatcher=function(){function b(){this.events={}}b.prototype.toJSON=function(){};b.prototype.parent=null;b.prototype.getParentEventHandler=function(){return this.parent};b.prototype.setParentEventHandler=function(a){this.parent=a};b.prototype.getEventHandler=function(a){this.events.hasOwnProperty(a)||(this.events[a]=new Odyssey.Events.EventHandler(a));return this.events[a]};b.prototype.dispatch=function(a,b){var c;this.getEventHandler(b.type).fire(a,b);b.propagationStopped||(c=
this.getParentEventHandler(),null!==c&&c.dispatch(a,b))};b.prototype.addListener=function(a,b){this.getEventHandler(a).addListener(b)};b.prototype.removeListener=function(a,b){this.getEventHandler(a).removeListener(b)};return b}();Odyssey.View={};Odyssey.View.ViewAttributor=function(){function b(){}b.prototype.setView=function(a){this.view=a};b.prototype.getView=function(){return this.view};return b}();Odyssey.Controller={};Odyssey.Controller.ControllerAttributor=function(){function b(){}b.prototype.setController=function(a){this.controller=a};b.prototype.getController=function(){return this.controller};return b}();Odyssey.Odyssey=function(){function b(){this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.controller=this.view=this.model=null}extend(b.prototype,new Odyssey.Events.EventDispatchInterface);extend(b.prototype,new Odyssey.Model.ModelAttributor);extend(b.prototype,new Odyssey.View.ViewAttributor);extend(b.prototype,new Odyssey.Controller.ControllerAttributor);return b}();Odyssey.Events.Event=function(){function b(a){this.type=a}b.prototype.propagationStopped=!1;b.prototype.stopPropagation=function(){this.propagationStopped=!0};b.prototype.defaultPrevented=!1;b.prototype.preventDefault=function(){this.defaultPrevented=!0};return b}();Odyssey.Events.InitializedEvent=function(){function b(){}extend(b.prototype,new Odyssey.Events.Event("OdysseyInitialized"));return b}();Odyssey.Model.Matrix3D=function(){function b(a,b,c){this.x=a;this.y=b;this.z=c}b.prototype.set=function(a,b,c){this.x=a;this.y=b;this.z=c};b.prototype.setEqual=function(a){this.set(a.x,a.y,a.z)};b.prototype.shift=function(a,b,c){console.assert(null!==this.x&&null!==this.y&&null!==this.z,"Cannot shift nulled matrix.");this.set(this.x+a,this.y+b,this.z+c);return this};b.prototype.equals=function(a,b,c){return this.x===a&&this.y===b&&this.z===c};b.prototype.equalsMatrix=function(a){return this.equals(a.x,
a.y,a.z)};b.prototype.toString=function(){return this.x+", "+this.y+", "+this.z};return b}();Odyssey.Events.MinimapRenderedEvent=function(){function b(){}extend(b.prototype,new Odyssey.Events.Event("OdysseyMiniMapRendered"));return b}();Odyssey.View.Minimap=function(){function b(){this.drawContext=this.canvas=null;this.position=new Odyssey.Model.Matrix3D(0,0,0);this.eventDispatcher=new Odyssey.Events.EventDispatcher}extend(b.prototype,new Odyssey.Events.EventDispatchInterface);b.prototype.drawPixel=function(a,b,c){this.drawContext.fillStyle="rgba("+(a>>24&255)+","+(a>>16&255)+","+(a>>8&255)+", "+(a>>0&255)+")";this.drawContext.fillRect(b,c,1,1)};b.prototype.setCanvas=function(a){this.canvas=a;this.drawContext=a.getContext("2d")};
b.prototype.update=function(){};return b}();Odyssey.View.DelayLoad=function(b){b(window).load(function(){b("img[data-src]").each(function(){b(this).attr("src",b(this).data("src"))})});return""}(jQuery);Odyssey.Events.SpriteIndexLoadedEvent=function(){function b(){}extend(b.prototype,new Odyssey.Events.Event("OdysseySpriteIndexLoaded"));return b}();Odyssey.View.SpriteIndex=OdysseySpriteIndex=function(b){function a(){this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.data=[]}extend(a.prototype,new Odyssey.Events.EventDispatchInterface);a.populateResourceManager=function(a,b){var e=a.data,f,h;f=0;for(h=e.length;f<h;f+=1)b.addBinaryFile(e[f].src)};a.prototype.isLoaded=!1;a.prototype.isLoading=!1;a.prototype.setLoading=function(a){this.isLoading=a};a.prototype.setLoaded=function(a){this.isLoaded=a};a.prototype.setData=function(a){0!==
this.data.length&&(this.data.length=0);Array.prototype.push.apply(this.data,a)};a.load=function(d){var c=new a;c.setLoading(!0);b.ajax({url:d,dataType:"json",success:function(a){c.setData(a);c.setLoading(!1);c.setLoaded(!0);c.dispatchEvent(new Odyssey.Events.SpriteIndexLoadedEvent)}});return c};return a}(jQuery);Odyssey.Model.MapFile=function(){function b(a,b,c){console.assert(4095>=a,"MapFile has invalid x. Must be between 0 and 4095. x="+a);console.assert(4095>=b,"MapFile has invalid y. Must be between 0 and 4095. y="+b);console.assert(15>=c,"MapFile has invalid z. Must be between 0 and 15. z="+c);this.baseX=a&4095;this.baseY=b&4095;this.baseZ=c&15}b.getOffset=function(a,b){return((a&65535)<<16)+(b&65535)};b.getFileX=function(a){console.assert("number"===typeof a,"Cannot get filename X-component of a non-number.");
return a>>8&255};b.getFileY=function(a){console.assert("number"===typeof a,"Cannot get filename Y-component of a non-number.");return a>>8&255};b.getFileZ=function(a){console.assert("number"===typeof a,"Cannot get filename Z-component of a non-number.");return a>>0&255};return b}();Odyssey.Model.MapFileParser=function(){function b(){this.tilePosition=new Odyssey.Model.Matrix3D(0,0,0)}b.getTileIndex=function(a,b){return Math.floor(b/32+(a<<3))};b.getTileOffset=function(a,b){return b%32};b.prototype.parse=function(a){var d,c,e,f,h=[],g=0;if(!a)return null;e=a.Explored;f=a.Map;for(d=255;0<=d;--d)for(c=255;0<=c;--c)e[b.getTileIndex(d,c)]>>b.getTileOffset(d,c)&1&&(g+=1,h[(d<<8)+c]=f[f.length-g]);a.Map=h;return a};return b}();Odyssey.Model.MapFileParserResult=function(){function b(){this.mapFiles=[]}b.resolveIndex=function(a,b,c){return((a&255)<<0)+((b&255)<<8)+((c&15)<<16)};return b}();Odyssey.Model.Model=function(){function b(){this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.worldSpawns=this.geography=this.world=null;this.maps={};this.mapsFailed={}}extend(b.prototype,new Odyssey.Events.EventDispatchInterface);b.prototype.setResourceManager=function(a){var b=this;this.resourceManager=a;this.resourceManager.setParentEventHandler(this.eventDispatcher);this.resourceManager.addEventListener("OdysseyBinaryFileLoaded",function(a){(a=a.file)&&a.hasOwnProperty("contents")&&
b.parseMapDataFile(a.contents)})};b.prototype.getResourceManager=function(){return this.resourceManager};b.prototype.parseMapDataFile=function(a){var b,c=this.maps;a=(new Odyssey.Model.MapFileParser).parse(a);b=Odyssey.Model.MapFileParserResult.resolveIndex(Odyssey.Model.MapFile.getFileX(a.BaseX),Odyssey.Model.MapFile.getFileY(a.BaseY),Odyssey.Model.MapFile.getFileZ(a.BaseZ));return c[b]=a};b.prototype.loadMapFile=function(a,b,c){a=Odyssey.Model.MapFileParserResult.resolveIndex(a,b,c)+".json";if(!this.resourceManager.hasFile(a))return!1;
a=this.resourceManager.getResourceIDByFilename(a);return this.resourceManager.isLoaded(a)||this.resourceManager.isLoading(a)?!0:(this.resourceManager.load(a),!1)};b.prototype.getMap=function(a,b,c){a=Odyssey.Model.MapFileParserResult.resolveIndex(Odyssey.Model.MapFile.getFileX(a),Odyssey.Model.MapFile.getFileY(b),Odyssey.Model.MapFile.getFileZ(c));return this.maps[a]};b.prototype.getTileItems=function(a,b,c){c=this.getMap(a,b,c);return c?(a=c.Map[(a-c.BaseX<<8)+(b-c.BaseY)])?a.Items||null:null:null};
b.prototype.mapIsLoaded=function(a,b,c){a=Odyssey.Model.MapFile.getFileX(a);b=Odyssey.Model.MapFile.getFileY(b);c=Odyssey.Model.MapFile.getFileZ(c);c=Odyssey.Model.MapFileParserResult.resolveIndex(a,b,c)+".json";if(!this.resourceManager.hasFile(c))return!0;c=this.resourceManager.getResourceIDByFilename(c);return this.resourceManager.isLoaded(c)};b.prototype.mapHasFailed=function(a,b,c){a=Odyssey.Model.MapFile.getFileX(a);b=Odyssey.Model.MapFile.getFileY(b);c=Odyssey.Model.MapFile.getFileZ(c);c=Odyssey.Model.MapFileParserResult.resolveIndex(a,
b,c)+".json";if(!this.resourceManager.hasFile(c))return!0;c=this.resourceManager.getResourceIDByFilename(c);return this.resourceManager.hasFailed(c)};b.prototype.loadMaps=function(a,b,c,e,f,h){var g,k,l=!0;a=Odyssey.Model.MapFile.getFileX(a);b=Odyssey.Model.MapFile.getFileY(b);c=Odyssey.Model.MapFile.getFileZ(c);e=Odyssey.Model.MapFile.getFileX(e);f=Odyssey.Model.MapFile.getFileY(f);for(h=Odyssey.Model.MapFile.getFileZ(h);a<=e;a+=1)for(g=b;g<=f;g+=1)for(k=c;k<=h;k+=1)this.loadMapFile(a,g,k)||(l=!1);
return l};b.prototype.mapsLoadedInRange=function(a,b,c,e,f,h){var g,k,l;a=Odyssey.Model.MapFile.getFileX(a);b=Odyssey.Model.MapFile.getFileY(b);c=Odyssey.Model.MapFile.getFileZ(c);e=Odyssey.Model.MapFile.getFileX(e);f=Odyssey.Model.MapFile.getFileY(f);for(h=Odyssey.Model.MapFile.getFileZ(h);a<=e;a+=1)for(g=b;g<=f;g+=1)for(k=c;k<=h;k+=1)if(l=Odyssey.Model.MapFileParserResult.resolveIndex(a,g,k)+".json",this.resourceManager.hasFile(l)&&(l=this.resourceManager.getResourceIDByFilename(l),!this.resourceManager.isLoaded(l)))return!1;
return!0};b.prototype.setDat=function(a){this.dat=a};b.prototype.getDat=function(){return this.dat};b.prototype.setWorld=function(a){this.world=a};b.prototype.getWorld=function(){return this.world};b.prototype.setGeography=function(a){this.geography=a};b.prototype.getGeography=function(){return this.geography};b.prototype.setWorldSpawns=function(a){this.worldSpawns=a};b.prototype.getWorldSpawns=function(){return this.worldSpawns};b.prototype.setMapIndex=function(a){this.mapIndex=a};b.prototype.getMapIndex=
function(){return this.mapIndex};return b}();Odyssey.Events.MapPositionChangedEvent=function(){function b(a,b){this.position=b}extend(b.prototype,new Odyssey.Events.Event("OdysseyMapPositionChange"));return b}();Odyssey.Events.MapZoomChangedEvent=function(){function b(a,b){this.zoom=b}extend(b.prototype,new Odyssey.Events.Event("OdysseyMapZoomChanged"));return b}();Odyssey.Events.MapRenderCompleteEvent=function(){function b(){}extend(b.prototype,new Odyssey.Events.Event("OdysseyMapRenderComplete"));return b}();Odyssey.View.TileMap=function(b){function a(){var a;this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.view=null;this.position=new Odyssey.Model.Matrix3D(0,0,0);this.renderedPosition=new Odyssey.Model.Matrix3D(0,0,0);this.zoom=1;this.origin=new Odyssey.Model.Matrix3D(18,10,0);this.failedRenderedTiles=[];this.failedRenderedTiles={};for(a=0;16>a;a+=1)this.failedRenderedTiles[a]=[];this.sizeY=this.sizeX=0;this.canvases=[];this.overlayCanvases=[]}a.CANVAS_NORTHWEST_ID=0;a.CANVAS_WEST_ID=1;a.CANVAS_SOUTHWEST_ID=
2;a.CANVAS_NORTH_ID=3;a.CANVAS_PIVOT_ID=4;a.CANVAS_SOUTH_ID=5;a.CANVAS_NORTHEAST_ID=6;a.CANVAS_EAST_ID=7;a.CANVAS_SOUTHEAST_ID=8;a.MAPFILE_SIZE_X=256;a.MAPFILE_SIZE_Y=256;a.MAPFILE_SIZE_Z=1;a.stopUpdateProxy=function(a){return function(){console.trace()}};extend(a.prototype,new Odyssey.Events.EventDispatchInterface);a.prototype.setView=function(a){this.view=a};a.prototype.repeatRendering=function(){this.view.getModel().getDat().isLoaded&&this.render()};a.prototype.adjustForZoomChange=function(a){a=
Math.ceil(23/a.zoom);var b=this.canvases,e;for(e in b)b.hasOwnProperty(e)&&(b[e].height=32*(a+1),b[e].width=32*(a+1));this.setSize(a,a)};a.prototype.awaitingRefresh=!1;a.prototype.update=function(){this.view.getResourceManager().isBusy()||this.render()};a.prototype.setViewport=function(a){this.viewport=a};a.prototype.setContainer=function(a){this.container=a};a.prototype.getContainer=function(){return this.container};a.prototype.setPosition=function(a,b,e){this.position.set(a,b,e);this.dispatchEvent(new Odyssey.Events.MapPositionChangedEvent(this,
this.position))};a.prototype.getPosition=function(){return this.position};a.prototype.setZoom=function(a){this.zoom.set(a);this.dispatchEvent(new Odyssey.Events.MapZoomChangedEvent(this,this.zoom))};a.prototype.setSize=function(a,b){this.sizeX=a;this.sizeY=b};a.prototype.getCanvasSectionIndex=function(a,b){var e=Math.floor((a-a%this.sizeX-(this.position.x-this.position.x%this.sizeX))/this.sizeX),f=Math.floor((b-b%this.sizeY-(this.position.y-this.position.y%this.sizeY))/this.sizeY);return-1<=e&&1>=
e&&-1<=f&&1>=f?3*(1+e)+(1+f):-1};a.prototype.getCanvasSection=function(a,b){var e=this.getCanvasSectionIndex(a,b);return-1===e?(console.log("Could not find canvas for "+a+", "+b),null):this.canvases[e]};a.prototype.getSpriteID=function(a,b,e,f,h,g){a=this.view.getModel().getDat().getItem(a);f=a.spr.length;a.hasOwnProperty(18)&&(b=e=0,g?b=1:h&&(b=2));a.a&&(f/=a.a);return a.spr[(e%a.y*a.x+b%a.x)%f]};a.prototype.getSpriteFileID=function(a){var b=this.view.getSpriteIndex().data,e,f=b.length,h;for(e=0;e<
f;e+=1)if(h=b[e],h.from<=a&&a<=h.to)return e;return-1};a.prototype.getSpriteFileContaining=function(a){return this.view.getSpriteIndex().data[this.getSpriteFileID(a)]};a.prototype.getSpriteOffsetX=function(a){var b=this.getSpriteFileContaining(a),e=1+(b.size>>1&1);return(a-b.from)%(24/e)*e};a.prototype.getSpriteOffsetY=function(a){var b=this.getSpriteFileContaining(a);return Math.floor((a-b.from)/(24/(1+(b.size>>1&1))))*(1+(b.size&1))};a.prototype.getSpriteSizeX=function(a){return 1+(this.getSpriteFileContaining(a).size>>
1&1)};a.prototype.getSpriteSizeY=function(a){return 1+(this.getSpriteFileContaining(a).size&1)};a.prototype.setCanvas=function(a,b){this.canvases[a]=b};a.prototype.setOverlayCanvas=function(a,b){this.overlayCanvases[a]=b};a.prototype.getCanvas=function(a){return this.canvases[a]};a.prototype.renderSprite=function(a,b,e,f,h,g,k){var l,u,p,q,m,n,r;f=this.getSpriteFileID(a);if(!this.view.getResourceManager().isLoaded(f))return this.view.getResourceManager().load(f),!1;try{if(r=this.getCanvasSection(b,
e))l=this.getSpriteOffsetX(a),u=this.getSpriteOffsetY(a),p=this.getSpriteSizeX(a),q=this.getSpriteSizeY(a),m=b%this.sizeX+1,n=e%this.sizeY+1,r.getContext("2d").drawImage(this.view.getResourceManager().getResourceImage(f),32*l,32*u,32*p,32*q,32*(m-(p-1))-(k+h),32*(n-(q-1))-(k+g),32*p,32*q);return!0}catch(t){return!1}};a.prototype.renderItem=function(a,b,e,f,h,g,k,l,u){a=this.getSpriteID(a,b,e,f,l,u);l=!0;this.renderSprite(a,b,e,f,h,g,k)||(l=!1);return l};a.getRenderOrderByDat=function(a,b){var e=[];
Array.prototype.push.apply(e,a);e.sort(function(a,d){return b.getItem(a.ID).hasOwnProperty(13)?!1:!0});return e};a.prototype.renderTile=function(b,c,e){var f=this.view.getModel().getTileItems(b,c,e),h,g,k,l=0,u=!1,p=!1,q,m,n,r=!0;if(null===f)return this.view.getModel().mapIsLoaded(b,c,e)||this.view.getModel().mapHasFailed(b,c,e)?!0:!1;f=a.getRenderOrderByDat(f,this.view.getModel().getDat());h=0;for(g=f.length;h<g;h+=1)k=f[h].ID,n=this.view.getModel().getDat().getItem(k),q=n.hasOwnProperty(25)?n[25][0]||
0:0,m=n.hasOwnProperty(25)?n[25][1]||0:0,this.renderItem(k,b,c,e,q,m,l,u,p)||(r=!1),n.hasOwnProperty(26)&&(l+=n[26][0]),n.hasOwnProperty(19)&&(p=!0),n.hasOwnProperty(20)&&(u=!0);return r};a.prototype.loadMaps=function(){var a=this.position,b,e,f,h,g;b=a.x-a.x%this.sizeX-this.sizeX;e=a.x-a.x%this.sizeX+2*this.sizeX-1;f=a.y-a.y%this.sizeY-this.sizeY;h=a.y-a.y%this.sizeY+2*this.sizeY-1;a=g=a.z;return this.view.getModel().loadMaps(b,f,g,e,h,a)};a.prototype.refresh=function(){var a=this.position,b,e,f,
h,g,k,l,u=!0;b=a.x-a.x%this.sizeX-this.sizeX;e=a.x-a.x%this.sizeX+2*this.sizeX-1;f=a.y-a.y%this.sizeY-this.sizeY;h=a.y-a.y%this.sizeY+2*this.sizeY-1;a=g=a.z;for(this.loadMaps();b<=e;b+=1)for(k=f;k<=h;k+=1)for(l=g;l<=a;l+=1)this.hasRenderFailed(b,k,l)&&(this.renderTile(b,k,l)?this.setRenderFailed(b,k,l,!1):(this.setRenderFailed(b,k,l,!0),u=!1));return u};a.prototype.show=function(){b(this.getContainer()).addClass("ready")};a.prototype.hide=function(){b(this.getContainer()).removeClass("ready")};a.prototype.render=
function(){this.dispatchEvent({type:"OdysseyBeginRenderProcess"});if(!this.view.getModel().getDat().isLoaded)return console.assert(this.view.getModel().getDat().isLoading,"Script must initialize before rendering."),!1;if(!this.loadMaps())return console.log("Maps not ready. Exiting."),!1;this.translate()&&(this.awaitingRefresh=!0,this.renderedPosition.set(this.position.x,this.position.y,this.position.z));if(this.renderSelective()){if(this.awaitingRefresh)return this.refresh()?(this.renderedPosition.set(this.position.x,
this.position.y,this.position.z),this.dispatchEvent(new Odyssey.Events.MapRenderCompleteEvent,this.show),!0):!1;this.renderedPosition.set(this.position.x,this.position.y,this.position.z);this.dispatchEvent(new Odyssey.Events.MapRenderCompleteEvent,this.show);return!0}return!1};a.prototype.renderSelective=function(){return this.refresh()};a.prototype.setRenderFailed=function(a,b,e,f){this.failedRenderedTiles[e][Odyssey.Model.MapFile.getOffset(a,b)]=void 0!==f?f:!0};a.prototype.hasRenderFailed=function(a,
b,e){return this.failedRenderedTiles[e][Odyssey.Model.MapFile.getOffset(a,b)]||!1};a.prototype.clearRenderFailed=function(){var a;for(a=0;16>a;a+=1)this.failedRenderedTiles[a].length=0};a.prototype.updateCanvasIDs=function(){this.canvases[a.CANVAS_NORTHWEST_ID].setAttribute("id","OdysseyMapCanvas-NW");this.canvases[a.CANVAS_NORTH_ID].setAttribute("id","OdysseyMapCanvas-N");this.canvases[a.CANVAS_NORTHEAST_ID].setAttribute("id","OdysseyMapCanvas-NE");this.canvases[a.CANVAS_WEST_ID].setAttribute("id",
"OdysseyMapCanvas-W");this.canvases[a.CANVAS_PIVOT_ID].setAttribute("id","OdysseyMapCanvas-P");this.canvases[a.CANVAS_EAST_ID].setAttribute("id","OdysseyMapCanvas-E");this.canvases[a.CANVAS_SOUTHWEST_ID].setAttribute("id","OdysseyMapCanvas-SW");this.canvases[a.CANVAS_SOUTH_ID].setAttribute("id","OdysseyMapCanvas-S");this.canvases[a.CANVAS_SOUTHEAST_ID].setAttribute("id","OdysseyMapCanvas-SE")};a.prototype.translate=function(){var a=this.position,b=this.renderedPosition,e=Math.floor(a.x/this.sizeX)-
Math.floor(b.x/this.sizeX),b=Math.floor(a.y/this.sizeY)-Math.floor(b.y/this.sizeY),f=Math.max(-3,Math.min(3,e)),h=Math.max(-3,Math.min(3,b)),g=Math.max(f,-f),k=Math.max(h,-h),l=Math.max(Math.min(1,e),-1),u=Math.max(Math.min(1,b),-1),p=a.x-a.x%this.sizeX,q=a.y-a.y%this.sizeY,m=this.canvases,n,r,t,v=!1;r=0;for(e=0>e?-1:1;r!==f;r+=e)for(t=0;3>t;t+=1)n=m[3*(1-l)+t],m[3*(1-l)+t]=m[3*(1-l+e)+t],m[3*(1-l+e)+t]=m[3*(1-l+2*e)+t],m[3*(1-l+2*e)+t]=n,n.getContext("2d").clearRect(0,0,32*(this.sizeX+1),32*(this.sizeY+
1));for(r=0;r<this.sizeX*g;r+=1)for(e=0;e<3*this.sizeY;e+=1)this.setRenderFailed(p+(0>l?-1:2-f)*this.sizeX+r,q+-1*this.sizeY+e,a.z,!0),v=!0;r=0;for(e=0>b?-1:1;r!==h;r+=e)for(t=0;3>t;t+=1)n=m[3*t+(1-u)],m[3*t+(1-u)]=m[3*t+(1-u+e)],m[3*t+(u+1-u)]=m[3*t+(1-u+2*e)],m[3*t+(1-u+2*e)]=n,n.getContext("2d").clearRect(0,0,32*(this.sizeX+1),32*(this.sizeY+1));for(r=0;r<3*this.sizeX;r+=1)for(e=0;e<this.sizeY*k;e+=1)this.setRenderFailed(p+-1*this.sizeX+r,q+(0>u?-1:2-h)*this.sizeY+e,a.z,!0),v=!0;this.viewport.style.transform=
"translate("+-32*(1+a.x%this.sizeX-Math.ceil(this.sizeX/2))+"px, "+-32*(1+a.y%this.sizeY-Math.ceil(this.sizeY/2))+"px)";this.updateCanvasIDs();return v};return a}(jQuery);Odyssey.Controller.OverlayControl=function(){function b(){this.eventDispatcher=new Odyssey.Events.EventDispatcher}extend(b.prototype,new Odyssey.Events.EventDispatchInterface);b.clearCanvas=function(a,b,c,e,f){a.getContext("2d").clearRect(b,c,e,f)};b.unpaintAll=function(){var a=this.context.overlayCanvases,d,c=a.length;for(d=0;d<c;d+=1)b.clearCanvas(a[d],0,0,a[d].width,a[d].height)};b.prototype.select=function(a){var b=this.context.getCanvasSectionIndex(a.x,a.y);-1!==b&&(b=this.context.overlayCanvases[b],
b=b.getContext("2d"),b.strokeStyle="#35ff60",b.strokeRect(32*(1+a.x%this.context.sizeX),32*(1+a.y%this.context.sizeY),32,32))};b.prototype.unselect=function(a){var d=this.context.getCanvasSectionIndex(a.x,a.y);-1!==d&&(d=this.context.overlayCanvases[d],b.clearCanvas(d,32*(1+a.x%this.context.sizeX),32*(1+a.y%this.context.sizeY),32,32))};b.prototype.setContext=function(a){this.context=a};b.prototype.update=function(){};return b}();Odyssey.View.View=function(){function b(){this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.spriteIndex=this.overlay=this.tileInfo=this.tileMap=this.worldMap=this.minimap=null}extend(b.prototype,new Odyssey.Events.EventDispatchInterface);b.updateProxy=function(a){return function(){a.update()}};b.prototype.setResourceManager=function(a){this.resourceManager=a;this.resourceManager.setParentEventHandler(this.eventDispatcher)};b.prototype.getResourceManager=function(){return this.resourceManager};
b.prototype.setModel=function(a){this.model=a};b.prototype.getModel=function(){return this.model};b.prototype.setMinimap=function(a){this.minimap=a;this.minimap.setParentEventHandler(this.eventDispatcher)};b.prototype.getMinimap=function(){return this.minimap};b.prototype.setWorldMap=function(a){this.worldMap=a;this.worldMap.setParentEventHandler(this.eventDispatcher)};b.prototype.getWorldMap=function(){return this.worldMap};b.prototype.setTileMap=function(a){this.tileMap=a;this.tileMap.setParentEventHandler(this.eventDispatcher)};
b.prototype.getTileMap=function(){return this.tileMap};b.prototype.setTileInfo=function(a){this.tileInfo=a;this.tileInfo.setParentEventHandler(this.eventDispatcher)};b.prototype.getTileInfo=function(){return this.tileInfo};b.prototype.setOverlay=function(a){this.overlay=a;this.overlay.setParentEventHandler(this.eventDispatcher)};b.prototype.getOverlay=function(){return this.overlay};b.prototype.setSpriteIndex=function(a){this.spriteIndex=a;this.spriteIndex.setParentEventHandler(this.eventDispatcher)};
b.prototype.getSpriteIndex=function(){return this.spriteIndex};b.prototype.getStatus=function(){return this.status};b.prototype.setStatus=function(a){this.status=a};b.prototype.setToolRow=function(a){this.toolRow=a};b.prototype.getToolRow=function(){return this.toolRow};b.prototype.setNavigationMenu=function(a){this.navigationMenu=a};b.prototype.getNavigationMenu=function(){return this.navigationMenu};b.prototype.update=function(){null!==this.minimap&&this.minimap.update(this.model,this);null!==this.worldMap&&
this.worldMap.update(this.model,this);null!==this.tileMap&&this.tileMap.update(this.model,this);null!==this.tileInfo&&this.tileInfo.update(this.model,this);null!==this.overlay&&this.overlay.update(this.model,this)};return b}();Odyssey.Events.MapClickEvent=function(){function b(a){this.position=a}extend(b.prototype,new Odyssey.Events.Event("OdysseyMapClick"));return b}();Odyssey.Controller.Controller=function(b){function a(){this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.context=null;this.controlStates=[];this.controlManager=null}var d=Odyssey.View.TileMap.CANVAS_NORTHWEST_ID,c=Odyssey.View.TileMap.CANVAS_NORTH_ID,e=Odyssey.View.TileMap.CANVAS_NORTHEAST_ID,f=Odyssey.View.TileMap.CANVAS_WEST_ID,h=Odyssey.View.TileMap.CANVAS_EAST_ID,g=Odyssey.View.TileMap.CANVAS_SOUTHWEST_ID,k=Odyssey.View.TileMap.CANVAS_SOUTH_ID,l=Odyssey.View.TileMap.CANVAS_SOUTHEAST_ID;
extend(a.prototype,new Odyssey.Events.EventDispatchInterface);a.CONTROL_OVERLAY_CLICK=0;a.prototype.handleControlOverlayClick=function(b){var p=this.context,q;q=b.target;var m=p.overlayCanvases;q=q===m[h]||q===m[e]||q===m[l]?1:q===m[f]||q===m[d]||q===m[g]?-1:0;q*=p.sizeX;var m=b.target,n=p.overlayCanvases,m=m===n[k]||m===n[g]||m===n[l]?1:m===n[c]||m===n[d]||m===n[e]?-1:0;q=p.position.x-p.position.x%p.sizeX+q+(Math.floor(b.offsetX/32)-1);b=p.position.y-p.position.y%p.sizeY+m*p.sizeY+(Math.floor(b.offsetY/
32)-1);m=p.position.z;this.isDisabled(a.CONTROL_OVERLAY_CLICK)||p.dispatchEvent(new p.Events.MapClickEvent(new p.Model.Matrix3D(q,b,m)))};a.prototype.setControlManager=function(a){this.controlManager=a};a.prototype.setContext=function(a){this.context=a};a.prototype.disable=function(a){this.controlStates[a]=!1};a.prototype.enable=function(a){this.controlStates[a]=!0};a.prototype.isDisabled=function(a){return!1===this.controlStates[a]};a.prototype.isEnabled=function(a){return!this.isDisabled(a)};a.prototype.initialize=
function(){var a=this;b(this.context.overlayCanvases).click(function(){a.handleControlOverlayClick()})};return a}(jQuery);Odyssey.Events.SearchFindEvent=function(){function b(a){this.messageID=a.id;this.result=a.result}extend(b.prototype,new Odyssey.Events.Event("OdysseySearchFind"));return b}();Odyssey.Events.SearchCompleteEvent=function(){function b(a){this.messageID=a.id;this.results=a.result}extend(b.prototype,new Odyssey.Events.Event("OdysseySearchComplete"));return b}();Odyssey.Controller.MapSearch=function(){function b(a){this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.action=a;this.data={}}function a(){var a=this;this.worker=new Worker("Odyssey/Scripts/Controller/Search.Worker.js");this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.messages=[];this.worker.onmessage=function(b){b=JSON.parse(b.data);var d=b.id,d=a.messages.hasOwnProperty(d)?a.messages[d]:null;null!==d&&("find"===b.type?d.dispatchEvent(new Odyssey.Events.SearchFindEvent(b)):
"complete"===b.type&&d.dispatchEvent(new Odyssey.Events.SearchCompleteEvent(b)))}}var d={};window.onmessage=function(a){var b,f;a.hasOwnProperty("id")&&(b=a.id,f=a.data,d.hasOwnProperty(b)&&("find"===a.type?d[b].dispatchEvent(new Odyssey.Events.SearchFindEvent(f)):"complete"===a.type&&d[b].dispatchEvent(new Odyssey.Events.SearchCompleteEvent(f))))};extend(b.prototype,new Odyssey.Events.EventDispatchInterface);b.prototype.setData=function(a){this.data=a};b.prototype.setID=function(a){this.id=a};extend(a.prototype,
new Odyssey.Events.EventDispatchInterface);a.prototype.createRequest=function(a,d){var f=new b(a);f.setParentEventHandler(this.eventDispatcher);f.setID(this.messages.length);f.setData(d);this.messages.push(f);return f};a.prototype.sendRequest=function(a){this.worker.postMessage(JSON.stringify(a))};a.prototype.find=function(a,b,d){a=this.createRequest("search",{items:a.items,sections:a.sections});"function"===typeof b&&a.addEventListener("OdysseySearchFind",b);"function"===typeof d&&a.addEventListener("OdysseySearchComplete",
d);this.sendRequest(a);return a};a.prototype.sendData=function(a){a=this.createRequest("send",a);this.sendRequest(a);return a};return a}();Odyssey.Controller.SearchControl=function(b){function a(){this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.mouseIsDown=!1}extend(a.prototype,new Odyssey.Events.EventDispatchInterface);extend(a.prototype,new Odyssey.View.ViewAttributor);extend(a.prototype,new Odyssey.Model.ModelAttributor);a.prototype.initialize=function(){function a(){var d,f,h,g=0,k;d=b("#OdysseySearchResultsContainer li");f=b("#OdysseySearchResultsContainer li .search-position");h=b("#OdysseySearchResultsContainer li .search-criteria");
d.removeClass("active").addClass("inactive");c.searcher.sendData(c.getModel().maps);k={items:[parseInt(b("#OdysseySearchItemID").val(),10)]};c.searcher.find(k,function(a){a=a.result;b(d[g]).removeClass("inactive").addClass("active");b(h[g]).text(a.items.join(", "));b(f[g]).text(a.position.x+", "+a.position.y+", "+a.position.z);g+=1},function(a){})}var c=this;c.searcher=new Odyssey.Controller.MapSearch;c.searcher.setParentEventHandler(c.eventDispatcher);b("#OdysseyOpenSearch").click(function(){b(document.body).toggleClass("state-search-active")});
b("#OdysseySearchContainer > .OdysseyBoxBackground, #OdysseySearchHeader").click(function(){b(document.body).toggleClass("state-search-active")});b("#OdysseySearchItemID").keypress(function(b){13===b.keyCode&&(b.preventDefault(),b.stopPropagation(),a())});b("#OdysseySearchSubmit").click(function(b){b.stopPropagation();a()})};return a}(jQuery);Odyssey.View.TileInfo=function(b){function a(){this.eventDispatcher=new Odyssey.Events.EventDispatcher}var d=b(".OdysseyToolTipItem"),c=b(".OdysseyToolTipItem .OdysseyToolTipID"),e=b(".OdysseyToolTipItem .OdysseyToolTipCount"),f=d.length;extend(a.prototype,new Odyssey.Events.EventDispatchInterface);a.prototype.setContext=function(a){this.context=a};a.prototype.showInfo=function(a,g,k){a=this.context.getTileItems(a,g,k);if(null===a||void 0===a)a=[];g=0;for(k=a.length;g<k;g+=1)b(c[g]).text(a[g].ID),
b(e[g]).text(a[g].Count),b(d[g]).show();for(;g<f;g+=1)b(d[g]).hide()};a.prototype.update=function(){};return a}(jQuery);Odyssey.Controller.NavigationControl=function(b){function a(){this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.context=null}extend(a.prototype,new Odyssey.Events.EventDispatchInterface);extend(a.prototype,new Odyssey.View.ViewAttributor);extend(a.prototype,new Odyssey.Model.ModelAttributor);a.KEYCODE_ARROW_DOWN=40;a.KEYCODE_ARROW_LEFT=37;a.KEYCODE_ARROW_UP=38;a.KEYCODE_ARROW_RIGHT=39;a.KEYCODE_PAGE_UP=33;a.KEYCODE_PAGE_DOWN=34;a.CTRL_MULTIPLIER=10;a.NOCTRL_MULTIPLIER=1;a.prototype.handleMapShiftControls=
function(b){var c=this.getView().getTileMap(),e=this.getView().getWorldMap(),f=c.getPosition(),h=b.ctrlKey?a.CTRL_MULTIPLIER:a.NOCTRL_MULTIPLIER,g=!1;b.keyCode===a.KEYCODE_ARROW_DOWN&&(b.preventDefault(),g=!0,c.setPosition(f.x,f.y+h,f.z));b.keyCode===a.KEYCODE_ARROW_LEFT&&(b.preventDefault(),g=!0,c.setPosition(f.x+-1*h,f.y,f.z));b.keyCode===a.KEYCODE_ARROW_UP&&(b.preventDefault(),g=!0,c.setPosition(f.x,f.y+-1*h,f.z));b.keyCode===a.KEYCODE_ARROW_RIGHT&&(b.preventDefault(),g=!0,c.setPosition(f.x+h,
f.y,f.z));b.keyCode===a.KEYCODE_PAGE_DOWN&&(b.preventDefault(),0<=f.z&&15>=f.z?15>f.z&&(g=!0,c.setPosition(f.x,f.y,f.z+1)):(g=!0,c.setPosition(f.x,f.y,7)));b.keyCode===a.KEYCODE_PAGE_UP&&(b.preventDefault(),0<=f.z&&15>=f.z?0<f.z&&(g=!0,c.setPosition(f.x,f.y,f.z+-1)):(g=!0,c.setPosition(f.x,f.y,7)));g&&e&&e.setMapPosition(f)};a.prototype.inputPreventPropagation=function(a){a.stopPropagation()};a.prototype.initialize=function(){var a=this,c=b(document.body),e=b("input");c.keydown(function(b){a.handleMapShiftControls(b)});
e.keydown(function(b){a.inputPreventPropagation(b)})};return a}(jQuery);Odyssey.Controller.ToolRowControl=function(b){function a(){this.eventDispatcher=new Odyssey.Events.EventDispatcher}extend(a.prototype,new Odyssey.Events.EventDispatchInterface);extend(a.prototype,new Odyssey.Model.ModelAttributor);extend(a.prototype,new Odyssey.View.ViewAttributor);a.prototype.initialize=function(){var a=this.getView().getToolRow();b(a.getToggleElement()).click(function(){console.log(a);a.toggle()})};return a}(jQuery);Odyssey.Model.MapIndex=OdysseyMapIndex=function(){function b(){this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.startPosition=new Odyssey.Model.Matrix3D(0,0,0);this.endPosition=new Odyssey.Model.Matrix3D(0,0,0)}extend(b.prototype,new Odyssey.Events.EventDispatchInterface);b.prototype.setStartPosition=function(a,b,c){this.startPosition.set(a,b,c)};b.prototype.setEndPosition=function(a,b,c){this.endPosition.set(a,b,c)};b.prototype.addToResourceManager=function(a){var b,c,e,f,h,g,k,l;b=Odyssey.Model.MapFile.getFileX(this.startPosition.x);
f=Odyssey.Model.MapFile.getFileY(this.startPosition.y);h=Odyssey.Model.MapFile.getFileZ(this.startPosition.z);g=Odyssey.Model.MapFile.getFileX(this.endPosition.x);k=Odyssey.Model.MapFile.getFileY(this.endPosition.y);for(l=Odyssey.Model.MapFile.getFileZ(this.endPosition.z);b<=g;b+=1)for(c=f;c<=k;c+=1)for(e=h;e<=l;e+=1)a.addBinaryFile(Odyssey.Model.MapFileParserResult.resolveIndex(b,c,e)+".json")};return b}();Odyssey.Model.WorldSpawns=function(){function b(){this.eventDispatcher=new Odyssey.Events.EventDispatcher}extend(b.prototype,new Odyssey.Events.EventDispatchInterface);return b}();Odyssey.Events.BinaryFileErrorEvent=function(){function b(a){this.file=a}extend(b.prototype,new Odyssey.Events.Event("OdysseyBinaryFileError"));return b}();Odyssey.Events.BinaryFileLoadedEvent=function(){function b(a){this.file=a}extend(b.prototype,new Odyssey.Events.Event("OdysseyBinaryFileLoaded"));return b}();Odyssey.Model.ResourceManagerFile=ResourceManagerFile=function(b){function a(a){this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.src=a;this.resource=null;this.state=0;this.contents=null}extend(a.prototype,new Odyssey.Events.EventDispatchInterface);a.imageFormats=[".png"];a.FLAG_LOADED=1;a.FLAG_LOAD_FAILED=2;a.FLAG_LOADING=4;a.FLAG_NOT_FOUND=8;a.FLAG_A=16;a.FLAG_A=32;a.FLAG_A=64;a.FLAG_A=128;a.FLAG_A=256;a.FLAG_A=512;a.FLAG_A=1024;a.FLAG_A=2048;a.FLAG_A=4096;a.FLAG_A=8192;a.FLAG_A=16384;
a.FLAG_A=32768;a.FLAG_A=65536;a.FLAG_A=131072;a.FLAG_A=262144;a.FLAG_A=524288;a.FLAG_A=1048576;a.load=function(b){var c=new a;c.load(b);return c};a.prototype.isLoaded=function(){return!!(this.state&a.FLAG_LOADED)};a.prototype.setIsLoaded=function(b){this.isLoaded()!==b&&(this.state^=a.FLAG_LOADED)};a.prototype.isLoading=function(){return!!(this.state&a.FLAG_LOADING)};a.prototype.setIsLoading=function(b){this.isLoading()!==b&&(this.state^=a.FLAG_LOADING)};a.prototype.isNotFound=function(){return!!(this.state&
a.FLAG_NOT_FOUND)};a.prototype.setIsNotFound=function(b){this.isNotFound()!==b&&(this.state^=a.FLAG_NOT_FOUND)};a.prototype.hasFailed=function(){return!!(this.state&a.FLAG_LOAD_FAILED)};a.prototype.setLoadFailed=function(b){this.hasFailed()!==b&&(this.state^=a.FLAG_LOAD_FAILED)};a.prototype.setState=function(a){this.state=a};a.prototype.load=function(b){var c=b.slice(-4);-1!==a.imageFormats.indexOf(c)?this.loadImage(b):this.loadBinary(b)};a.prototype.loadImage=function(a){var b=this;b.isLoaded()||
(b.setIsLoading(!0),this.resource instanceof Image||(this.resource=new Image,this.resource.onload=function(){b.setIsLoading(!1);b.isLoaded()||(b.setIsLoaded(!0),b.dispatchEvent(new Odyssey.Events.BinaryFileLoadedEvent(b)))},this.resource.onerror=function(){b.setIsLoading(!1);b.setLoadFailed(!0);b.dispatchEvent(new Odyssey.Events.BinaryFileErrorEvent(b))},this.resource.src=a),this.resource.complete&&(b.setIsLoading(!1),b.isLoaded()||(b.setIsLoaded(!0),b.dispatchEvent(new Odyssey.Events.BinaryFileLoadedEvent(b)))))};
a.prototype.loadBinary=function(a){var c=this;c.setIsLoading(!0);b.ajax({url:a,dataType:"json",success:function(a){c.setContents(a);c.setIsLoading(!1);c.isLoaded()||(c.setIsLoaded(!0),c.dispatchEvent(new Odyssey.Events.BinaryFileLoadedEvent(c)))},error:function(){c.setIsLoading(!1);c.setLoadFailed(!0);c.dispatchEvent(new Odyssey.Events.BinaryFileErrorEvent(c))}})};a.prototype.getResource=function(){return this.resource};a.prototype.getResourceContents=function(){return this.resource&&this.resource.contents||
null};a.prototype.setContents=function(a){this.contents=a};return a}(jQuery);Odyssey.Generics.ResourceManager=function(){function b(){var a=0;this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.spritesheets=[];this.srcs={};this.resources=[];this.prefix="";this.getUniqueFileID=function(){var b=a;a+=1;return b};this.resourcesAwaitingLoad=[];this.resourcesAwaitingLoadMap={};this.loaded=[];this.addEventListener("OdysseyBinaryFileLoaded",proxy(this.filterAwaiting,this,null));this.addEventListener("OdysseyBinaryFileLoaded",proxy(this.loadNextResource,this,null));this.activeLoaders=
0}extend(b.prototype,new Odyssey.Events.EventDispatchInterface);b.MAX_CONNECTIONS=1;b.getFileBitmaskID=function(a){return Math.floor(a/32)};b.getFileBitmask=function(a){return 1<<a%32};b.prototype.setFilepathPrefix=function(a){this.prefix=a};b.prototype.addBinaryFile=function(a){var d,c;d=this.getUniqueFileID();a=this.prefix+a;c=new Odyssey.Model.ResourceManagerFile(a);c.setParentEventHandler(this.eventDispatcher);b.getFileBitmaskID(d);this.resources[d]=c;return this.srcs[a]=d};b.prototype.getValue=
function(a){var d;d=b.getFileBitmaskID(a);a=b.getFileBitmask(a);return!!(this[d]&a)};b.prototype.setValue=function(a,d){var c,e;return d!==this.getValue(a)?(c=b.getFileBitmaskID(a),e=b.getFileBitmask(a),this[c]^=e,!0):!1};b.prototype.getResource=function(a){return void 0===this.resources[a]?null:this.resources[a]};b.prototype.getResourceImage=function(a){return(a=this.getResource(a))&&a.resource instanceof Image?a.resource:null};b.prototype.getResourceData=function(a){return(a=this.getResource(a))?
a.getData():null};b.prototype.isLoading=function(){var a,b=arguments.length,c;for(a=0;a<b;a+=1)if(c=this.getResource(arguments[a]),c.isLoading())return!0;return!1};b.prototype.isLoaded=function(){var a,b=arguments.length,c;for(a=0;a<b;a+=1)if(c=this.getResource(arguments[a]),!c.isLoaded())return!1;return!0};b.prototype.isNotFound=function(){var a,b=arguments.length,c;for(a=0;a<b;a+=1)if(c=this.getResource(arguments[a]),c.isNotFound())return!0;return!1};b.prototype.hasFailed=function(){var a,b=arguments.length,
c;for(a=0;a<b;a+=1)if(c=this.getResource(arguments[a]),c.hasFailed())return!0;return!1};b.prototype.isAwaitingLoad=function(a){return this.resourcesAwaitingLoadMap.hasOwnProperty(a)};b.prototype.setAwaitingLoad=function(a){this.isAwaitingLoad(a)||(this.resourcesAwaitingLoadMap[a]=0,this.resourcesAwaitingLoad.push(a));this.resourcesAwaitingLoadMap[a]+=1};b.prototype.filterAwaiting=function(){var a,b=this.resourcesAwaitingLoad.length,c,e=0;for(a=0;a<b;a+=1)if(c=this.getResource(this.resourcesAwaitingLoad[a]),
e&&(this.resourcesAwaitingLoad[a-e]=this.resourcesAwaitingLoad[a]),null===c||c.isLoaded())this.loaded.push(c),e+=1;this.resourcesAwaitingLoad.length-=e};b.prototype.sortAwaiting=function(){var a=this.resourcesAwaitingLoadMap;this.resourcesAwaitingLoad.sort(function(b,c){return(a[b]||0)-(a[c]||0)})};b.prototype.start=function(a){var b;a=a||1;this.resourceIndex=this.resourceCount=this.resourcesAwaitingLoad.length;for(b=0;b<a;b+=1)this.activeLoaders+=1,this.loadNextResource()};b.prototype.stop=function(a){this.activeLoaders-=
a};b.prototype.stopLoader=function(){this.stop(1)};b.prototype.startLoader=function(){this.start(1)};b.prototype.load=function(a){this.isLoading(a)||this.isLoaded(a)||(this.setAwaitingLoad(a),this.canOpenConnection()&&this.start(1))};b.prototype.canOpenConnection=function(){return this.activeLoaders<b.MAX_CONNECTIONS};b.prototype.loadNextResource=function(){var a=this.getNextLoadResourceID();-1===a?this.stop(1):this.loadResource(a)};b.prototype.getNextLoadResourceID=function(){var a,b=this.resourcesAwaitingLoad;
for(this.resourceIndex=b.length;0<this.resourceIndex;)if(--this.resourceIndex,void 0!==b[this.resourceIndex]&&(a=this.getResource(b[this.resourceIndex]),!a.isLoaded()&&!a.isLoading()))return this.resourceIndex;return-1};b.prototype.resourceExists=function(a){return null!==this.getResource(a)};b.prototype.isBusy=function(){return 0<this.resourcesAwaitingLoad.length};b.prototype.loadResource=function(a){var b=this.getResource(this.resourcesAwaitingLoad[a]);void 0!==this.resourcesAwaitingLoad[a]&&this.resourceExists(this.resourcesAwaitingLoad[a])&&
(b.isLoaded()||b.isLoading()||b.load(b.src))};b.prototype.getResourceIDByFilename=function(a){return this.getResourceIDByFilenameWithPrefix(this.prefix+a)};b.prototype.getResourceIDByFilenameWithPrefix=function(a){if(!this.hasFileWithPrefix(a))throw Error("Resource "+a+" does not exist.");return this.srcs[a]};b.prototype.hasFile=function(a){return this.hasFileWithPrefix(this.prefix+a)};b.prototype.hasFileWithPrefix=function(a){return this.srcs.hasOwnProperty(a)};b.prototype.getLoadedCount=function(){return this.loaded.length};
b.prototype.getLoadingCount=function(){return this.resourcesAwaitingLoad.length};return b}();Odyssey.Events.LinkClickEvent=function(){function b(a,b,c){this.x=a;this.y=b;this.z=c}extend(b.prototype,new Odyssey.Events.Event("OdysseyLinkClick"));return b}();Odyssey.Controller.LinkClickControl=function(b){function a(){this.eventDispatcher=new Odyssey.Events.EventDispatcher}extend(a.prototype,new Odyssey.Events.EventDispatchInterface);extend(a.prototype,new Odyssey.View.ViewAttributor);extend(a.prototype,new Odyssey.Model.ModelAttributor);a.isLink=function(a){return"A"===a.nodeName};a.prototype.setViewPosition=function(a){this.getView().getTileMap().setPosition(parseInt(a.x,10),parseInt(a.y,10),parseInt(a.z,10))};a.prototype.processClick=function(b){var c,
e={},f,h;if(a.isLink(b)){if((b=(b=(b=b.href.split("?"))&&b[1])&&b.split("&"))&&b.length)for(f=0,h=b.length;f<h;f+=1)c=b[f].split("="),e[c[0]]=c[1];if(e.x&&e.y&&e.z)return this.dispatchEvent(new Odyssey.Events.LinkClickEvent(parseInt(e.x,10),parseInt(e.y,10),parseInt(e.z,10)),this.setViewPosition),!1}};a.handleClickProxy=function(a){return function(b){a.processClick(b.target)||b.preventDefault()}};a.prototype.initialize=function(){b(document).click(a.handleClickProxy(this))};return a}(jQuery);Odyssey.Events.DatLoadedEvent=function(){function b(){}extend(b.prototype,new Odyssey.Events.Event("OdysseyDatLoaded"));return b}();Odyssey.Model.Dat=function(b){function a(){this.eventDispatcher=new Odyssey.Events.EventDispatcher}extend(a.prototype,new Odyssey.Events.EventDispatchInterface);a.ATTRIBUTE_ID_GROUND=0;a.ATTRIBUTE_ID_TOPORDER1=1;a.ATTRIBUTE_ID_TOPORDER2=2;a.ATTRIBUTE_ID_TOPORDER3=3;a.ATTRIBUTE_ID_CONTAINER=4;a.ATTRIBUTE_ID_STACKABLE=5;a.ATTRIBUTE_ID_CORPSE=6;a.ATTRIBUTE_ID_USABLE=7;a.ATTRIBUTE_ID_WRITABLE=8;a.ATTRIBUTE_ID_READABLE=9;a.ATTRIBUTE_ID_FLUID=10;a.ATTRIBUTE_ID_SPLASH=11;a.ATTRIBUTE_ID_BLOCKING=12;a.ATTRIBUTE_ID_IMMOBILE=
13;a.ATTRIBUTE_ID_BLOCKSMISSILE=14;a.ATTRIBUTE_ID_BLOCKSPATH=15;a.ATTRIBUTE_ID_BLOCKING2=16;a.ATTRIBUTE_ID_PICKUPABLE=17;a.ATTRIBUTE_ID_HANGABLE=18;a.ATTRIBUTE_ID_HORIZONTAL=19;a.ATTRIBUTE_ID_VERTICAL=20;a.ATTRIBUTE_ID_ROTATABLE=21;a.ATTRIBUTE_ID_LIGHT=22;a.ATTRIBUTE_ID_UNKNOWN_17=23;a.ATTRIBUTE_ID_FLOORCHANGE=24;a.ATTRIBUTE_ID_OFFSET=25;a.ATTRIBUTE_ID_HEIGHTED=26;a.ATTRIBUTE_ID_BOTTOMLAYER=27;a.ATTRIBUTE_ID_IDLEANIMATION=28;a.ATTRIBUTE_ID_MINIMAP=29;a.ATTRIBUTE_ID_ACTIONED=30;a.ATTRIBUTE_ID_GROUNDITEM=
31;a.ATTRIBUTE_ID_LOOKTHROUGH=32;a.ATTRIBUTE_ID_BODYRESTRICTION=33;a.ATTRIBUTE_ID_MARKETPROPS=34;a.ATTRIBUTE_ID_UNKNOWN_1021_23=35;a.ATTRIBUTE_ID_UNKNOWN_1021_FE=254;a.ATTRIBUTE_NAME_FRAMES="a";a.ATTRIBUTE_NAME_WIDTH="w";a.ATTRIBUTE_NAME_HEIGHT="h";a.ATTRIBUTE_NAME_BASE="b";a.ATTRIBUTE_NAME_SIZEX="x";a.ATTRIBUTE_NAME_SIZEY="y";a.ATTRIBUTE_NAME_SIZEZ="z";a.ATTRIBUTE_NAME_SPRITES="spr";a.Colors={0:255,12:6684927,24:13369599,30:16711935,40:855690495,51:855690495,86:1717987071,114:2570256639,121:2573612031,
129:2576980479,179:3439329279,186:4281532671,192:4284875007,207:4291598847,210:4294902015,215:4294967295};a.prototype.isLoaded=!1;a.prototype.isLoading=!1;a.prototype.setData=function(a){this.data=a};a.prototype.setLoaded=function(a){this.isLoaded=a;this.dispatchEvent(new Odyssey.Events.DatLoadedEvent)};a.prototype.setLoading=function(a){this.isLoading=a};a.prototype.getMapColor=function(b){return this.data[0][b].hasOwnProperty(a.ATTRIBUTE_ID_MINIMAP)?a.Colors[this.data[0][b][a.ATTRIBUTE_ID_MINIMAP][0]]||
null:null};a.prototype.getItem=function(a){return this.data[0][a]||null};a.load=function(d){var c=new a;c.setLoading(!0);b.ajax({url:d,dataType:"json",success:function(a){c.setData(a);c.setLoaded(!0);c.setLoading(!1)}});return c};return a}(jQuery);Odyssey.Events.ToolRowShowEvent=function(){function b(){}extend(b.prototype,new Odyssey.Events.Event("OdysseyToolRowShow"));return b}();Odyssey.Events.ToolRowHideEvent=function(){function b(){}extend(b.prototype,new Odyssey.Events.Event("OdysseyToolRowHide"));return b}();Odyssey.View.ToolRow=function(b){function a(){this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.active=!1;this.ui={}}extend(a.prototype,new Odyssey.Events.EventDispatchInterface);a.prototype.setToggleElement=function(a){this.ui.open=a};a.prototype.getToggleElement=function(){return this.ui.open};a.prototype.show=function(){b(document.body).addClass("state-tools-active");this.active=!0;this.dispatchEvent(new Odyssey.Events.ToolRowShowEvent)};a.prototype.hide=function(){b(document.body).removeClass("state-tools-active");
this.active=!1;this.dispatchEvent(new Odyssey.Events.ToolRowHideEvent)};a.prototype.toggle=function(){this.active?this.hide():this.show()};return a}(jQuery);Odyssey.Model.Geography=function(){function b(){this.eventDispatcher=new Odyssey.Events.EventDispatcher}extend(b.prototype,new Odyssey.Events.EventDispatchInterface);return b}();Odyssey.Model.World=function(){function b(){this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.items={}}extend(b.prototype,new Odyssey.Events.EventDispatchInterface);b.prototype.tileExists=function(a,b,c){return!(void 0===this[a]||void 0===this[a][b]||void 0===this[a][b][c])};b.prototype.getTile=function(a,b,c){return this.tileExists(a,b,c)?this[a][b][c]:null};b.prototype.containsItem=function(a){return this.items.hasOwnProperty(a)};b.prototype.addItem=function(a){void 0===this.items[a]&&
(this.items[a]=0);this.items[a]+=1};b.prototype.addTile=function(a,b,c,e){void 0===this[a]&&(this[a]={});void 0===this[a][b]&&(this[a][b]={});this[a][b][c]=e;for(a=0;a<e.items.length;a+=1)b=e.items[a],this.addItem(b.ID)};return b}();Odyssey.Events.WorldMapOpenLinkClickEvent=function(){function b(){}extend(b.prototype,new Odyssey.Events.Event("OdysseyWorldMapOpenLinkClick"));return b}();Odyssey.Events.WorldMapToggleEvent=function(){function b(){}extend(b.prototype,new Odyssey.Events.Event("OdysseyWorldMapToggle"));return b}();Odyssey.Events.WorldMapHideEvent=function(){function b(){}extend(b.prototype,new Odyssey.Events.Event("OdysseyWorldMapHide"));return b}();Odyssey.Events.WorldMapShowEvent=function(){function b(){}extend(b.prototype,new Odyssey.Events.Event("OdysseyWorldMapShow"));return b}();Odyssey.View.WorldMap=function(b){function a(){this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.position=new Odyssey.Model.Matrix3D(null,null,null);this.mapZoom=1;this.ui={mapImages:[]};this.visible=this.mouseIsDown=!1;this.mapPosition=new Odyssey.Model.Matrix3D(33053,31013,7)}extend(a.prototype,new Odyssey.Events.EventDispatchInterface);a.MIN_POSITION_X=31744;a.MIN_POSITION_Y=30976;a.SIZE_X=2049;a.SIZE_Y=2305;a.MIN_ZOOM=1;a.MAX_ZOOM=5;a.DEFAULT_ZOOM=1;a.prototype.show=function(){this.visible=
!0;b("body").addClass("state-minimap-active");this.dispatchEvent(new Odyssey.Events.WorldMapShowEvent)};a.prototype.hide=function(){this.visible=!1;b("body").removeClass("state-minimap-active");this.dispatchEvent(new Odyssey.Events.WorldMapHideEvent)};a.prototype.toggle=function(){this.visible?this.hide():this.show();this.dispatchEvent(new Odyssey.Events.WorldMapToggleEvent)};a.prototype.setPosition=function(a,b,e){this.position.set(a,b,e);this.dispatchEvent(new OdysseyWorldMapPositionChangeEvent(this.position))};
a.prototype.setFocusAreaElement=function(a){this.ui.focusArea=a};a.prototype.getFocusAreaElement=function(){return this.ui.focusArea||null};a.prototype.setWrapperElement=function(a){this.ui.wrapper=a};a.prototype.getWrapperElement=function(){return this.ui.wrapper||null};a.prototype.setMapViewportElement=function(a){this.ui.viewport=a};a.prototype.getMapViewportElement=function(){return this.ui.viewport||null};a.prototype.setMapContainerElement=function(a){this.ui.mapContainer=a};a.prototype.getMapContainerElement=
function(){return this.ui.mapContainer||null};a.prototype.setMapImageElement=function(a,b){this.ui.mapImages[a]=b};a.prototype.getMapImageElement=function(a){return this.ui.mapImages[a]||null};a.prototype.getMapImageElements=function(){return this.ui.mapImages||null};a.prototype.update=function(){var a=b(this.getMapViewportElement()),c=a.width(),a=a.height(),e;e=this.getFocusAreaElement();null!==e&&(e.style.left=this.mapZoom*this.position.x+"px",e.style.top=this.mapZoom*this.position.y+"px");e=this.getMapContainerElement();
null!==e&&(e.style.left=-this.mapZoom*(this.position.x-c/2)+"px",e.style.top=-this.mapZoom*(this.position.y-a/2)+"px")};a.prototype.zoom=function(b){var c,e,f,h,g;this.mapZoom=b;c=this.getMapImageElements();h=Math.floor(a.SIZE_X*b);g=Math.floor(a.SIZE_Y*b);e=0;for(f=c.length;e<f;e+=1)b=c[e],null!==b&&(b.width=h,b.height=g);this.update()};a.prototype.setFloor=function(a){b(this.getMapImageElement(this.position.z)).removeClass("active").addClass("inactive");b(this.getMapImageElement(a)).removeClass("inactive").addClass("active")};
a.prototype.getMapPosition=function(){return this.mapPosition};a.prototype.setMapPosition=function(b){this.mapPosition.set(Math.floor(b.x),Math.floor(b.y),Math.floor(b.z));this.position.x=this.mapPosition.x-a.MIN_POSITION_X;this.position.y=this.mapPosition.y-a.MIN_POSITION_Y;this.mapPosition.z!==this.position.z&&(this.setFloor(this.mapPosition.z),this.position.z=this.mapPosition.z);this.update()};return a}(jQuery);Odyssey.Events.WorldMapCloseLinkClickEvent=function(){function b(){}extend(b.prototype,new Odyssey.Events.Event("OdysseyWorldMapCloseLinkClick"));return b}();Odyssey.Controller.WorldMapControl=function(b){function a(){this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.mouseIsDown=!1}extend(a.prototype,new Odyssey.Events.EventDispatchInterface);extend(a.prototype,new Odyssey.View.ViewAttributor);extend(a.prototype,new Odyssey.Model.ModelAttributor);a.prototype.processShowClick=function(){this.getView().getWorldMap().show()};a.prototype.processHideClick=function(){this.getView().getWorldMap().hide()};a.prototype.setPosition=function(a,b,e){this.getView().getWorldMap().setMapPosition(a,
b,e)};a.prototype.initialize=function(){function a(e){var f=c.getView().getWorldMap(),d=b(f.getMapContainerElement()).offset();if(0>e.pageX-d.left||0>e.pageY-d.top)return!1;f.setMapPosition({x:Odyssey.View.WorldMap.MIN_POSITION_X+(e.pageX-d.left)/f.mapZoom,y:Odyssey.View.WorldMap.MIN_POSITION_Y+(e.pageY-d.top)/f.mapZoom,z:f.mapPosition.z})}var c=this;b("#OdysseyOpenMinimap").click(function(){c.dispatchEvent(new Odyssey.Events.WorldMapOpenLinkClickEvent,c.processShowClick);return!1});b("#OdysseyMinimapCloseLink").click(function(a){c.dispatchEvent(new Odyssey.Events.WorldMapCloseLinkClickEvent,
c.processHideClick);return!1});b(document.body).mouseup(function(){c.mouseIsDown=!1});b(this.getView().getWorldMap().getMapViewportElement()).mousedown(function(){c.mouseIsDown=!0;return!1});b(this.getView().getWorldMap().getMapViewportElement()).mousemove(function(b){c.mouseIsDown&&a(b)});b(this.getView().getWorldMap().getMapViewportElement()).on("touch",function(b){a(b.originalEvent.targetTouches[0])});this.getView().getWorldMap().addEventListener("OdysseyWorldMapClose",function(){var a=this.getView().getWorldMap().getMapPosition();
this.getView().getTileMap().setPosition(a.x,a.y,a.z)})};return a}(jQuery);Odyssey.View.Status=function(b){function a(){this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.ui={}}extend(a.prototype,new Odyssey.Events.EventDispatchInterface);a.prototype.getStatusTextField=function(){return this.ui.statusText};a.prototype.setStatusTextField=function(a){this.ui.statusText=a};a.prototype.setContainer=function(a){this.ui.container=a};a.prototype.getContainer=function(){return this.ui.container};a.prototype.setProgressBar=function(a){this.ui.progressBar=a};a.prototype.getProgressBar=
function(){return this.ui.progressBar};a.prototype.setStatusText=function(a){b(this.getStatusTextField()).text(a)};a.prototype.setProgress=function(a){this.progress=a;b(this.getProgressBar()).width(100*a+"%")};a.prototype.update=function(){};return a}(jQuery);Odyssey.Controller.ControlManager=function(){function b(){this.eventDispatcher=new Odyssey.Events.EventDispatcher;this.controls=[]}extend(b.prototype,new Odyssey.Events.EventDispatchInterface);extend(b.prototype,new Odyssey.Model.ModelAttributor);extend(b.prototype,new Odyssey.View.ViewAttributor);extend(b.prototype,new Odyssey.Controller.ControllerAttributor);b.prototype.addControl=function(a){this.controls.push(a);a.setParentEventHandler(this.eventDispatcher);a.setView(this.getView());a.setModel(this.getModel());
"function"===typeof a.initialize&&a.initialize()};return b}();Odyssey.main=function(){function b(a,b,c){for(;a.length<c;)a+=b;return a}function a(){c+=1;2<=c&&d.dispatchEvent(new Odyssey.Events.InitializedEvent)}var d=new Odyssey.Odyssey,c=0;d.setModel(function(){var b=new Odyssey.Model.Model;b.setParentEventHandler(d.eventDispatcher);b.setDat(function(){var b=Odyssey.Model.Dat.load("Odyssey/Data/dat.json");b.addEventListener("OdysseyDatLoaded",a);return b}());b.setResourceManager(function(){var a=new Odyssey.Generics.ResourceManager;a.setFilepathPrefix("Odyssey/Maps/");
return a}());b.setMapIndex(function(){var a=new Odyssey.Model.MapIndex;a.setStartPosition(31744,30976,0);a.setEndPosition(33791,33279,15);a.addToResourceManager(b.getResourceManager());return a}());b.setWorld(function(){var a=new Odyssey.Model.World;a.setParentEventHandler(b.eventDispatcher);return a}());b.setGeography(function(){var a=new Odyssey.Model.Geography;a.setParentEventHandler(b.eventDispatcher);return a}());b.setWorldSpawns(function(){var a=new Odyssey.Model.WorldSpawns;a.setParentEventHandler(b.eventDispatcher);
return a}());return b}());d.setView(function(){var c=new Odyssey.View.View;c.setParentEventHandler(d.eventDispatcher);c.setModel(d.getModel());d.addEventListener("OdysseyInitialized",Odyssey.View.View.updateProxy(c));d.addEventListener("OdysseyBinaryFileLoaded",Odyssey.View.View.updateProxy(c));d.addEventListener("OdysseyMapZoomChange",Odyssey.View.View.updateProxy(c));d.addEventListener("OdysseyMapPositionChange",Odyssey.View.View.updateProxy(c));c.setResourceManager(function(){var a=new Odyssey.Generics.ResourceManager;
a.setFilepathPrefix("Odyssey/Sprites/");return a}());c.setSpriteIndex(function(){function b(){Odyssey.View.SpriteIndex.populateResourceManager(d,c.getResourceManager())}var d=Odyssey.View.SpriteIndex.load("Odyssey/Data/SpriteSheetIndex.json");d.addEventListener("OdysseySpriteIndexLoaded",a);d.addEventListener("OdysseySpriteIndexLoaded",b);d.isLoaded&&(b(),a());return d}());c.setToolRow(function(){var a=new Odyssey.View.ToolRow;a.setToggleElement(document.getElementById("OdysseyOpenToolRow"));return a}());
c.setMinimap(function(){var a=new Odyssey.View.Minimap;a.setParentEventHandler(c.eventDispatcher);a.setCanvas(document.getElementById("OdysseyMinimapCanvas"));return a}());c.setWorldMap(function(){var a=new Odyssey.View.WorldMap,d;a.setParentEventHandler(c.eventDispatcher);a.setWrapperElement(document.getElementById("OdysseyLargeMinimap"));a.setMapViewportElement(document.getElementById("OdysseyMinimapViewport"));a.setMapContainerElement(document.getElementById("OdysseyMinimapContainer"));a.setFocusAreaElement(document.getElementById("OdysseyMinimapActive"));
for(d=0;16>d;d+=1)a.setMapImageElement(d,document.getElementById("MinimapFloor"+b(String(d),"0",2)));return a}());c.setTileMap(function(){var a=new Odyssey.View.TileMap;a.setParentEventHandler(c.eventDispatcher);a.setView(c);a.setContainer(document.getElementById("map-container"));a.setViewport(document.getElementById("map-viewport-translator"));a.setSize(23,23);a.setCanvas(Odyssey.View.TileMap.CANVAS_NORTHWEST_ID,document.getElementById("OdysseyMapCanvas-NW"));a.setCanvas(Odyssey.View.TileMap.CANVAS_NORTH_ID,
document.getElementById("OdysseyMapCanvas-N"));a.setCanvas(Odyssey.View.TileMap.CANVAS_NORTHEAST_ID,document.getElementById("OdysseyMapCanvas-NE"));a.setCanvas(Odyssey.View.TileMap.CANVAS_WEST_ID,document.getElementById("OdysseyMapCanvas-W"));a.setCanvas(Odyssey.View.TileMap.CANVAS_PIVOT_ID,document.getElementById("OdysseyMapCanvas-P"));a.setCanvas(Odyssey.View.TileMap.CANVAS_EAST_ID,document.getElementById("OdysseyMapCanvas-E"));a.setCanvas(Odyssey.View.TileMap.CANVAS_SOUTHWEST_ID,document.getElementById("OdysseyMapCanvas-SW"));
a.setCanvas(Odyssey.View.TileMap.CANVAS_SOUTH_ID,document.getElementById("OdysseyMapCanvas-S"));a.setCanvas(Odyssey.View.TileMap.CANVAS_SOUTHEAST_ID,document.getElementById("OdysseyMapCanvas-SE"));a.setOverlayCanvas(Odyssey.View.TileMap.CANVAS_NORTHWEST_ID,document.getElementById("OdysseyMapCanvasOverlay-NW"));a.setOverlayCanvas(Odyssey.View.TileMap.CANVAS_NORTH_ID,document.getElementById("OdysseyMapCanvasOverlay-N"));a.setOverlayCanvas(Odyssey.View.TileMap.CANVAS_NORTHEAST_ID,document.getElementById("OdysseyMapCanvasOverlay-NE"));
a.setOverlayCanvas(Odyssey.View.TileMap.CANVAS_WEST_ID,document.getElementById("OdysseyMapCanvasOverlay-W"));a.setOverlayCanvas(Odyssey.View.TileMap.CANVAS_PIVOT_ID,document.getElementById("OdysseyMapCanvasOverlay-P"));a.setOverlayCanvas(Odyssey.View.TileMap.CANVAS_EAST_ID,document.getElementById("OdysseyMapCanvasOverlay-E"));a.setOverlayCanvas(Odyssey.View.TileMap.CANVAS_SOUTHWEST_ID,document.getElementById("OdysseyMapCanvasOverlay-SW"));a.setOverlayCanvas(Odyssey.View.TileMap.CANVAS_SOUTH_ID,document.getElementById("OdysseyMapCanvasOverlay-S"));
a.setOverlayCanvas(Odyssey.View.TileMap.CANVAS_SOUTHEAST_ID,document.getElementById("OdysseyMapCanvasOverlay-SE"));a.setPosition(32367,32615,7);c.addEventListener("OdysseyWorldMapHide",function(){var b=this.getMapPosition();a.setPosition(b.x,b.y,b.z)});return a}());c.setTileInfo(function(){var a=new Odyssey.View.TileInfo;d.addEventListener("OdysseyMapClick",function(b){a.showInfo(b.position.x,b.position.y,b.position.z)});a.setParentEventHandler(c.eventDispatcher);return a}());c.setOverlay(function(){var a=
new Odyssey.Controller.OverlayControl;d.addEventListener("OdysseyMapClick",function(b){a.select(b.position)});a.setParentEventHandler(c.eventDispatcher);return a}());c.setStatus(function(){var a=new Odyssey.View.Status;a.setContainer(document.getElementById("OdysseyStatus"));a.setStatusTextField(document.getElementById("ProgressText"));a.setProgressBar(document.getElementById("ProgressBar"));d.addEventListener("OdysseyBinaryFileLoaded",function(){var b,d=0;b=0+c.getResourceManager().getLoadingCount();
d+=c.getResourceManager().getLoadedCount();a.setStatusText("Loading Sprites ("+d+" / "+(d+b)+")");a.setProgress(Math.floor(100*(d||0)/((b||0)+(d||0)||Infinity))/100)});return a}());return c}());d.setController(function(){var a=new Odyssey.Controller.Controller;a.setParentEventHandler(d.eventDispatcher);a.setControlManager(function(){var b=new Odyssey.Controller.ControlManager;b.setParentEventHandler(a.eventDispatcher);b.setView(d.getView());b.setModel(d.getModel());b.addControl(new Odyssey.Controller.ToolRowControl);
b.addControl(new Odyssey.Controller.LinkClickControl);b.addControl(new Odyssey.Controller.WorldMapControl);b.addControl(new Odyssey.Controller.SearchControl);b.addControl(new Odyssey.Controller.NavigationControl);return b}());return a}());return d}();
